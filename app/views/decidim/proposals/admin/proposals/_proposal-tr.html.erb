<tr data-id="<%= proposal.id %>"
    <%= "data-published-state=false" if proposal.answered? && !proposal.published_state? %>>
  <td>
    <%= check_box_tag "proposal_ids_s[]", proposal.id, false, class: "js-check-all-proposal js-proposal-list-check  js-proposal-id-#{proposal.id}" %>
    <br>
  </td>
  <td>
    <%= proposal.id %><br>
  </td>
  <td>
    <div class="table__title-block">
      <span class="table__title-icon">
        <% if unanswered_proposals_overdue?(proposal) || evaluating_proposals_overdue?(proposal) %>
          <%= icon "datetime", class: "text-alert" %>
        <% elsif grace_period_unanswered?(proposal) || grace_period_evaluating?(proposal) %>
          <%= icon "timer", class: "text-warning" %>
        <% end %>
      </span>
      <div class="table__list-title">
        <%= link_to(
              decidim_html_escape(present(proposal).title).html_safe,
              proposal_path(proposal)
            ) %>
        <% if unanswered_proposals_overdue?(proposal) %>
          <div class="help-text-overdue text-alert">
            <%= time_ago_in_words(last_day_to_answer(proposal),
                                  scope: "decidim.reporting_proposals.admin.answer_overdue.datetime.distance_in_words") %>
          </div>
        <% elsif evaluating_proposals_overdue?(proposal) %>
          <div class="help-text-overdue text-alert">
            <%= time_ago_in_words(last_day_to_evaluate(proposal),
                                  scope: "decidim.reporting_proposals.admin.answer_overdue.datetime.distance_in_words") %>
          </div>
        <% elsif grace_period_unanswered?(proposal) %>
          <div class="help-text-overdue text-warning">
            <%= time_ago_in_words(last_day_to_answer(proposal),
                                  scope: "decidim.reporting_proposals.admin.answer_pending.datetime.distance_in_words") %>
          </div>
        <% elsif grace_period_evaluating?(proposal) %>
          <div class="help-text-overdue text-warning">
            <%= time_ago_in_words(last_day_to_evaluate(proposal),
                                  scope: "decidim.reporting_proposals.admin.evaluate_pending.datetime.distance_in_words") %>
          </div>
          <% elsif proposal.accepted? || proposal.rejected? %>
          <div class="help-text-overdue text-success">
            <%= t("decidim.reporting_proposals.admin.resolution_time") %>:
            <%= time_elapsed_to_answer(proposal) %>
          </div>
        <% end %>
      </div>
    </div>
  </td>
  <td>
    <% if proposal.category %>
      <%= translated_attribute proposal.category.name %>
    <% end %>
  </td>

  <%= td_resource_scope_for(proposal.scope) %>

  <td>
    <strong class="<%= proposal_state_css_class proposal %>">
      <%= t("decidim/amendment", scope: "activerecord.models", count: 1) if proposal.emendation? %>
      <%= proposal_complete_state proposal %>
    </strong>
  </td>

  <% unless current_settings.publish_answers_immediately? %>
    <td>
      <% if proposal.answered? && !proposal.emendation? %>
        <%= humanize_boolean proposal.published_state? %>
      <% else %>
        -
      <% end %>
    </td>
  <% end %>

  <% if current_settings.votes_enabled? %>
    <td>
      <%= proposal.proposal_votes_count %>
    </td>
  <% end %>

  <% if current_component.settings.comments_enabled? and !current_settings.comments_blocked? %>
    <td>
      <%= proposal.comments_count %>
    </td>
  <% end %>

  <td>
    <%= proposal.proposal_notes_count %>
  </td>

  <td class="valuators-count">
    <%= proposal.valuation_assignments.count %>
  </td>

  <td>
    <%= l proposal.created_at, format: :decidim_short %>
  </td>

  <td class="table-list__actions">
    <% if allowed_to? :edit, :proposal, proposal: proposal %>
      <%= icon_link_to "pencil", edit_proposal_path(proposal), t("actions.edit_proposal", scope: "decidim.proposals"), class: "action-icon--edit-proposal" %>
    <% else %>
      <span class="action-space icon"></span>
    <% end %>

    <%= icon_with_link_to_proposal(proposal) %>

    <%= resource_permissions_link(proposal) %>

    <%= icon_link_to "eye", resource_locator(proposal).path, t("actions.preview", scope: "decidim.proposals.admin"), class: "action-icon--preview", target: :blank %>

    <% if Decidim::ReportingProposals.allow_admins_to_hide_proposals && !proposal.reported? %>
      <%= cell("decidim/flag_modal", proposal, modal_id: "flagModal#{proposal.id}") %>
      <button type="button" class="link-alt"
              data-open="<%= current_user.present? ? "flagModal#{proposal.id}" : "loginModal" %>"
              title="<%= t("report", scope: "decidim.proposals.proposals.show") %>"
              aria-controls="<%= current_user.present? ? "flagModal#{proposal.id}" : "loginModal" %>"
              aria-haspopup="true"
              tabindex="0"
              style="color:#97a2b2; cursor: pointer">
        <%= icon "flag", aria_hidden: true, class: "action-icon--preview", role: "img", "aria-hidden": true %>
        <span class="show-for-sr">
      <%= t("report", scope: "decidim.proposals.proposals.show") %>
    </span>
      </button>
    <% end %>
    <% if proposal.reported? %>
      <%= icon_link_to "trash", decidim_admin_reporting_proposals.hide_proposal_path(id: proposal),
                       t("actions.hide", scope: "decidim.moderations"), method: :put, class: "action-icon" %>
    <% end %>
  </td>
</tr>
